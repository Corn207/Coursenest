version: '3.4'

services:
  gatewayapi:
    image: ${DOCKER_REGISTRY-}gatewayapi
    container_name: GatewayAPI
    build:
      context: .
      dockerfile: GatewayAPI/Dockerfile
    networks:
      - frontend
      - backend

  authentication.api:
    image: ${DOCKER_REGISTRY-}authenticationapi
    container_name: API-Authentication
    build:
      context: .
      dockerfile: Services/Authentication/Authentication.API/Dockerfile
    networks:
      - backend
    depends_on:
      - database
      - messagebus

  identity.api:
    image: ${DOCKER_REGISTRY-}identityapi
    container_name: API-Identity
    build:
      context: .
      dockerfile: Services/Identity/Identity.API/Dockerfile
    networks:
      - backend
    depends_on:
      - database
      - messagebus

  library.api:
    image: ${DOCKER_REGISTRY-}libraryapi
    container_name: API-Library
    build:
      context: .
      dockerfile: Services/Library/Library.API/Dockerfile
    networks:
      - backend
    depends_on:
      - database
      - messagebus

  payment.api:
    image: ${DOCKER_REGISTRY-}paymentapi
    container_name: API-Payment
    build:
      context: .
      dockerfile: Services/Payment/Payment.API/Dockerfile
    networks:
      - backend
    depends_on:
      - messagebus

  userdata.api:
    image: ${DOCKER_REGISTRY-}userdataapi
    container_name: API-Userdata
    build:
      context: .
      dockerfile: Services/UserData/UserData.API/Dockerfile
    networks:
      - backend
    depends_on:
      - database
      - messagebus

  database:
    image: mcr.microsoft.com/mssql/server:2019-latest
    container_name: Database
    environment:
      - ACCEPT_EULA=Y
      - MSSQL_PID=Express
    networks:
      - backend

  messagebus:
    image: masstransit/rabbitmq
    container_name: MessageBus
    networks:
      - backend

networks:
  frontend:
  backend: